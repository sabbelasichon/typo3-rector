import{Plugin as e}from"@ckeditor/ckeditor5-core";import{toArray as t,priorities as i,CKEditorError as o,isValidAttributeName as r,uid as l}from"@ckeditor/ckeditor5-utils";import{Matcher as n,UpcastWriter as s,HtmlDataProcessor as m}from"@ckeditor/ckeditor5-engine";import{toWidget as a,Widget as c}from"@ckeditor/ckeditor5-widget";import{cloneDeep as d,startCase as u,mergeWith as h,pull as b,isPlainObject as g,isEqual as f}from"lodash-es";import{Enter as w}from"@ckeditor/ckeditor5-enter";
/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function p(e,t,i,o){t&&function(e,t,i){if(t.attributes)for(const[o]of Object.entries(t.attributes))e.removeAttribute(o,i);if(t.styles)for(const o of Object.keys(t.styles))e.removeStyle(o,i);t.classes&&e.removeClass(t.classes,i)}(e,t,o),i&&A(e,i,o)}function A(e,t,i){if(t.attributes)for(const[o,r]of Object.entries(t.attributes))e.setAttribute(o,r,i);t.styles&&e.setStyle(t.styles,i),t.classes&&e.addClass(t.classes,i)}function v(e,t,i,o,r){const l=t.getAttribute(i),n={};for(const e of["attributes","styles","classes"]){if(e!=o){l&&l[e]&&(n[e]=l[e]);continue}if("classes"==o){const t=new Set(l&&l.classes||[]);r(t),t.size&&(n[e]=Array.from(t));continue}const t=new Map(Object.entries(l&&l[e]||{}));r(t),t.size&&(n[e]=Object.fromEntries(t))}Object.keys(n).length?t.is("documentSelection")?e.setSelectionAttribute(i,n):e.setAttribute(i,n,t):l&&(t.is("documentSelection")?e.removeSelectionAttribute(i):e.removeAttribute(i,t))}function y(e){return`html${t=e,u(t).replace(/ /g,"")}Attributes`;var t}
/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function E({model:e}){return(t,i)=>i.writer.createElement(e,{htmlContent:t.getCustomProperty("$rawContent")})}function k(e,{view:t,isInline:i}){const o=e.t;return(e,{writer:r})=>{const l=o("HTML object"),n=C(t,e,r),s=e.getAttribute(y(t));r.addClass("html-object-embed__content",n),s&&A(r,s,n);const m=r.createContainerElement(i?"span":"div",{class:"html-object-embed","data-html-object-embed-label":l},n);return a(m,r,{label:l})}}function C(e,t,i){return i.createRawElement(e,null,((e,i)=>{i.setContentOf(e,t.getAttribute("htmlContent"))}))}function S({view:e,model:t,allowEmpty:i},o){return t=>{t.on(`element:${e}`,((e,t,l)=>{let n=o.processViewAttributes(t.viewItem,l);if(n||l.consumable.test(t.viewItem,{name:!0})){if(n=n||{},l.consumable.consume(t.viewItem,{name:!0}),t.modelRange||(t=Object.assign(t,l.convertChildren(t.viewItem,t.modelCursor))),i&&t.modelRange.isCollapsed&&Object.keys(n).length){const e=l.writer.createElement("htmlEmptyElement");if(!l.safeInsert(e,t.modelCursor))return;const i=l.getSplitParts(e);return t.modelRange=l.writer.createRange(t.modelRange.start,l.writer.createPositionAfter(i[i.length-1])),l.updateConversionResult(e,t),void r(e,n,l)}for(const e of t.modelRange.getItems())r(e,n,l)}}),{priority:"low"})};function r(e,i,o){if(o.schema.checkAttribute(e,t)){const r=function(e,t){const i=d(e);let o="attributes";for(o in t)i[o]="classes"==o?Array.from(new Set([...e[o]||[],...t[o]])):{...e[o],...t[o]};return i}(i,e.getAttribute(t)||{});o.writer.setAttribute(t,r,e)}}}function F({model:e,view:t},i){return(o,{writer:r,consumable:l})=>{if(!o.hasAttribute(e))return null;const n=r.createContainerElement(t),s=o.getAttribute(e);return l.consume(o,`attribute:${e}`),A(r,s,n),n.getFillerOffset=()=>null,i?a(n,r):n}}function $({priority:e,view:t}){return(i,o)=>{if(!i)return;const{writer:r}=o,l=r.createAttributeElement(t,null,{priority:e});return A(r,i,l),l}}function O({view:e},t){return i=>{i.on(`element:${e}`,((e,i,o)=>{if(!i.modelRange||i.modelRange.isCollapsed)return;const r=t.processViewAttributes(i.viewItem,o);r&&o.writer.setAttribute(y(i.viewItem.name),r,i.modelRange)}),{priority:"low"})}}function I({view:e,model:t}){return i=>{i.on(`attribute:${y(e)}:${t}`,((e,t,i)=>{if(!i.consumable.consume(t.item,e.name))return;const{attributeOldValue:o,attributeNewValue:r}=t;p(i.writer,o,r,i.mapper.toViewElement(t.item))}))}}
/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */var _=[{model:"codeBlock",view:"pre"},{model:"paragraph",view:"p"},{model:"blockQuote",view:"blockquote"},{model:"listItem",view:"li"},{model:"pageBreak",view:"div"},{model:"rawHtml",view:"div"},{model:"table",view:"table"},{model:"tableRow",view:"tr"},{model:"tableCell",view:"td"},{model:"tableCell",view:"th"},{model:"tableColumnGroup",view:"colgroup"},{model:"tableColumn",view:"col"},{model:"caption",view:"caption"},{model:"caption",view:"figcaption"},{model:"imageBlock",view:"img"},{model:"imageInline",view:"img"},{model:"htmlP",view:"p",modelSchema:{inheritAllFrom:"$block"}},{model:"htmlBlockquote",view:"blockquote",modelSchema:{inheritAllFrom:"$container"}},{model:"htmlTable",view:"table",modelSchema:{allowWhere:"$block",isBlock:!0}},{model:"htmlTbody",view:"tbody",modelSchema:{allowIn:"htmlTable",isBlock:!1}},{model:"htmlThead",view:"thead",modelSchema:{allowIn:"htmlTable",isBlock:!1}},{model:"htmlTfoot",view:"tfoot",modelSchema:{allowIn:"htmlTable",isBlock:!1}},{model:"htmlCaption",view:"caption",modelSchema:{allowIn:"htmlTable",allowChildren:"$text",isBlock:!1}},{model:"htmlColgroup",view:"colgroup",modelSchema:{allowIn:"htmlTable",allowChildren:"col",isBlock:!1}},{model:"htmlCol",view:"col",modelSchema:{allowIn:"htmlColgroup",isBlock:!1}},{model:"htmlTr",view:"tr",modelSchema:{allowIn:["htmlTable","htmlThead","htmlTbody"],isLimit:!0}},{model:"htmlTd",view:"td",modelSchema:{allowIn:"htmlTr",allowContentOf:"$container",isLimit:!0,isBlock:!1}},{model:"htmlTh",view:"th",modelSchema:{allowIn:"htmlTr",allowContentOf:"$container",isLimit:!0,isBlock:!1}},{model:"htmlFigure",view:"figure",modelSchema:{inheritAllFrom:"$container",isBlock:!1}},{model:"htmlFigcaption",view:"figcaption",modelSchema:{allowIn:"htmlFigure",allowChildren:"$text",isBlock:!1}},{model:"htmlAddress",view:"address",modelSchema:{inheritAllFrom:"$container",isBlock:!1}},{model:"htmlAside",view:"aside",modelSchema:{inheritAllFrom:"$container",isBlock:!1}},{model:"htmlMain",view:"main",modelSchema:{inheritAllFrom:"$container",isBlock:!1}},{model:"htmlDetails",view:"details",modelSchema:{inheritAllFrom:"$container",isBlock:!1}},{model:"htmlSummary",view:"summary",modelSchema:{allowChildren:"$text",allowIn:"htmlDetails",isBlock:!1}},{model:"htmlDiv",view:"div",paragraphLikeModel:"htmlDivParagraph",modelSchema:{inheritAllFrom:"$container"}},{model:"htmlFieldset",view:"fieldset",modelSchema:{inheritAllFrom:"$container",isBlock:!1}},{model:"htmlLegend",view:"legend",modelSchema:{allowIn:"htmlFieldset",allowChildren:"$text"}},{model:"htmlHeader",view:"header",modelSchema:{inheritAllFrom:"$container",isBlock:!1}},{model:"htmlFooter",view:"footer",modelSchema:{inheritAllFrom:"$container",isBlock:!1}},{model:"htmlForm",view:"form",modelSchema:{inheritAllFrom:"$container",isBlock:!0}},{model:"htmlHgroup",view:"hgroup",modelSchema:{allowChildren:["htmlH1","htmlH2","htmlH3","htmlH4","htmlH5","htmlH6"],isBlock:!1}},{model:"htmlH1",view:"h1",modelSchema:{inheritAllFrom:"$block"}},{model:"htmlH2",view:"h2",modelSchema:{inheritAllFrom:"$block"}},{model:"htmlH3",view:"h3",modelSchema:{inheritAllFrom:"$block"}},{model:"htmlH4",view:"h4",modelSchema:{inheritAllFrom:"$block"}},{model:"htmlH5",view:"h5",modelSchema:{inheritAllFrom:"$block"}},{model:"htmlH6",view:"h6",modelSchema:{inheritAllFrom:"$block"}},{model:"$htmlList",modelSchema:{allowWhere:"$container",allowChildren:["$htmlList","htmlLi"],isBlock:!1}},{model:"htmlDir",view:"dir",modelSchema:{inheritAllFrom:"$htmlList"}},{model:"htmlMenu",view:"menu",modelSchema:{inheritAllFrom:"$htmlList"}},{model:"htmlUl",view:"ul",modelSchema:{inheritAllFrom:"$htmlList"}},{model:"htmlOl",view:"ol",modelSchema:{inheritAllFrom:"$htmlList"}},{model:"htmlLi",view:"li",modelSchema:{allowIn:"$htmlList",allowChildren:"$text",isBlock:!1}},{model:"htmlPre",view:"pre",modelSchema:{inheritAllFrom:"$block"}},{model:"htmlArticle",view:"article",modelSchema:{inheritAllFrom:"$container",isBlock:!1}},{model:"htmlSection",view:"section",modelSchema:{inheritAllFrom:"$container",isBlock:!1}},{model:"htmlNav",view:"nav",modelSchema:{inheritAllFrom:"$container",isBlock:!1}},{model:"htmlDivDl",view:"div",modelSchema:{allowChildren:["htmlDt","htmlDd"],allowIn:"htmlDl"}},{model:"htmlDl",view:"dl",modelSchema:{allowWhere:"$container",allowChildren:["htmlDt","htmlDd","htmlDivDl"],isBlock:!1}},{model:"htmlDt",view:"dt",modelSchema:{allowChildren:"$block",isBlock:!1}},{model:"htmlDd",view:"dd",modelSchema:{allowChildren:"$block",isBlock:!1}},{model:"htmlCenter",view:"center",modelSchema:{inheritAllFrom:"$container",isBlock:!1}}],T=[{model:"htmlLiAttributes",view:"li",appliesToBlock:!0,coupledAttribute:"listItemId"},{model:"htmlOlAttributes",view:"ol",appliesToBlock:!0,coupledAttribute:"listItemId"},{model:"htmlUlAttributes",view:"ul",appliesToBlock:!0,coupledAttribute:"listItemId"},{model:"htmlFigureAttributes",view:"figure",appliesToBlock:"table"},{model:"htmlTheadAttributes",view:"thead",appliesToBlock:"table"},{model:"htmlTbodyAttributes",view:"tbody",appliesToBlock:"table"},{model:"htmlFigureAttributes",view:"figure",appliesToBlock:"imageBlock"},{model:"htmlAcronym",view:"acronym",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlTt",view:"tt",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlFont",view:"font",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlTime",view:"time",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlVar",view:"var",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlBig",view:"big",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlSmall",view:"small",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlSamp",view:"samp",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlQ",view:"q",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlOutput",view:"output",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlKbd",view:"kbd",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlBdi",view:"bdi",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlBdo",view:"bdo",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlAbbr",view:"abbr",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlA",view:"a",priority:5,coupledAttribute:"linkHref"},{model:"htmlStrong",view:"strong",coupledAttribute:"bold",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlB",view:"b",coupledAttribute:"bold",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlI",view:"i",coupledAttribute:"italic",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlEm",view:"em",coupledAttribute:"italic",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlS",view:"s",coupledAttribute:"strikethrough",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlDel",view:"del",coupledAttribute:"strikethrough",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlIns",view:"ins",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlU",view:"u",coupledAttribute:"underline",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlSub",view:"sub",coupledAttribute:"subscript",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlSup",view:"sup",coupledAttribute:"superscript",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlCode",view:"code",coupledAttribute:"code",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlMark",view:"mark",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlSpan",view:"span",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlCite",view:"cite",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlLabel",view:"label",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlDfn",view:"dfn",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlObject",view:"object",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlIframe",view:"iframe",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlInput",view:"input",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlButton",view:"button",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlTextarea",view:"textarea",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlSelect",view:"select",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlVideo",view:"video",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlEmbed",view:"embed",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlOembed",view:"oembed",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlAudio",view:"audio",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlImg",view:"img",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlCanvas",view:"canvas",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlMeter",view:"meter",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlProgress",view:"progress",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlScript",view:"script",modelSchema:{allowWhere:["$text","$block"],isInline:!0}},{model:"htmlStyle",view:"style",modelSchema:{allowWhere:["$text","$block"],isInline:!0}},{model:"htmlCustomElement",view:"$customElement",modelSchema:{allowWhere:["$text","$block"],allowAttributesOf:"$inlineObject",isInline:!0}}];
/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class P extends e{constructor(){super(...arguments),this._definitions=[]}static get pluginName(){return"DataSchema"}init(){for(const e of _)this.registerBlockElement(e);for(const e of T)this.registerInlineElement(e)}registerBlockElement(e){this._definitions.push({...e,isBlock:!0})}registerInlineElement(e){this._definitions.push({...e,isInline:!0})}extendBlockElement(e){this._extendDefinition({...e,isBlock:!0})}extendInlineElement(e){this._extendDefinition({...e,isInline:!0})}getDefinitionsForView(e,t=!1){const i=new Set;for(const o of this._getMatchingViewDefinitions(e)){if(t)for(const e of this._getReferences(o.model))i.add(e);i.add(o)}return i}getDefinitionsForModel(e){return this._definitions.filter((t=>t.model==e))}_getMatchingViewDefinitions(e){return this._definitions.filter((t=>t.view&&function(e,t){if("string"==typeof e)return e===t;if(e instanceof RegExp)return e.test(t);return!1}(e,t.view)))}*_getReferences(e){const i=["inheritAllFrom","inheritTypesFrom","allowWhere","allowContentOf","allowAttributesOf"],o=this._definitions.filter((t=>t.model==e));for(const{modelSchema:r}of o)if(r)for(const o of i)for(const i of t(r[o]||[])){const t=this._definitions.filter((e=>e.model==i));for(const o of t)i!==e&&(yield*this._getReferences(o.model),yield o)}}_extendDefinition(e){const t=Array.from(this._definitions.entries()).filter((([,t])=>t.model==e.model));if(0!=t.length)for(const[i,o]of t)this._definitions[i]=h({},o,e,((e,t)=>Array.isArray(e)?e.concat(t):void 0));else this._definitions.push(e)}}!function(e,{insertAt:t}={}){if(!e||"undefined"==typeof document)return;const i=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css",window.litNonce&&o.setAttribute("nonce",window.litNonce),"top"===t&&i.firstChild?i.insertBefore(o,i.firstChild):i.appendChild(o),o.styleSheet?o.styleSheet.cssText=e:o.appendChild(document.createTextNode(e))}(":root{--ck-html-object-embed-unfocused-outline-width:1px}.ck-widget.html-object-embed{background-color:var(--ck-color-base-foreground);font-size:var(--ck-font-size-base);min-width:calc(76px + var(--ck-spacing-standard));padding:var(--ck-spacing-small);padding-top:calc(var(--ck-font-size-tiny) + var(--ck-spacing-large))}.ck-widget.html-object-embed:not(.ck-widget_selected):not(:hover){outline:var(--ck-html-object-embed-unfocused-outline-width) dashed var(--ck-color-widget-blurred-border)}.ck-widget.html-object-embed:before{background:#999;border-radius:0 0 var(--ck-border-radius) var(--ck-border-radius);color:var(--ck-color-base-background);content:attr(data-html-object-embed-label);font-family:var(--ck-font-face);font-size:var(--ck-font-size-tiny);font-style:normal;font-weight:400;left:var(--ck-spacing-standard);padding:calc(var(--ck-spacing-tiny) + var(--ck-html-object-embed-unfocused-outline-width)) var(--ck-spacing-small) var(--ck-spacing-tiny);position:absolute;top:0;transition:background var(--ck-widget-handler-animation-duration) var(--ck-widget-handler-animation-curve)}.ck-widget.html-object-embed .ck-widget__type-around .ck-widget__type-around__button.ck-widget__type-around__button_before{margin-left:50px}.ck-widget.html-object-embed .html-object-embed__content{pointer-events:none}div.ck-widget.html-object-embed{margin:1em auto}span.ck-widget.html-object-embed{display:inline-block}");
/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */
class B extends e{constructor(e){super(e),this._dataSchema=e.plugins.get("DataSchema"),this._allowedAttributes=new n,this._disallowedAttributes=new n,this._allowedElements=new Set,this._disallowedElements=new Set,this._dataInitialized=!1,this._coupledAttributes=null,this._registerElementsAfterInit(),this._registerElementHandlers(),this._registerCoupledAttributesPostFixer(),this._registerAssociatedHtmlAttributesPostFixer()}static get pluginName(){return"DataFilter"}static get requires(){return[P,c]}loadAllowedConfig(e){for(const t of e){const e=t.name||/[\s\S]+/,i=N(t);this.allowElement(e),i.forEach((e=>this.allowAttributes(e)))}}loadDisallowedConfig(e){for(const t of e){const e=t.name||/[\s\S]+/,i=N(t);0==i.length?this.disallowElement(e):i.forEach((e=>this.disallowAttributes(e)))}}loadAllowedEmptyElementsConfig(e){for(const t of e)this.allowEmptyElement(t)}allowElement(e){for(const t of this._dataSchema.getDefinitionsForView(e,!0))this._addAllowedElement(t),this._coupledAttributes=null}disallowElement(e){for(const t of this._dataSchema.getDefinitionsForView(e,!1))this._disallowedElements.add(t.view)}allowEmptyElement(e){for(const t of this._dataSchema.getDefinitionsForView(e,!0))t.isInline&&this._dataSchema.extendInlineElement({...t,allowEmpty:!0})}allowAttributes(e){this._allowedAttributes.add(e)}disallowAttributes(e){this._disallowedAttributes.add(e)}processViewAttributes(e,t){return D(e,t,this._disallowedAttributes),D(e,t,this._allowedAttributes)}_addAllowedElement(e){if(!this._allowedElements.has(e)){if(this._allowedElements.add(e),"appliesToBlock"in e&&"string"==typeof e.appliesToBlock)for(const t of this._dataSchema.getDefinitionsForModel(e.appliesToBlock))t.isBlock&&this._addAllowedElement(t);this._dataInitialized&&this.editor.data.once("set",(()=>{this._fireRegisterEvent(e)}),{priority:i.highest+1})}}_registerElementsAfterInit(){this.editor.data.on("init",(()=>{this._dataInitialized=!0;for(const e of this._allowedElements)this._fireRegisterEvent(e)}),{priority:i.highest+1})}_registerElementHandlers(){this.on("register",((e,t)=>{const i=this.editor.model.schema;if(t.isObject&&!i.isRegistered(t.model))this._registerObjectElement(t);else if(t.isBlock)this._registerBlockElement(t);else{if(!t.isInline)throw new o("data-filter-invalid-definition",null,t);this._registerInlineElement(t)}e.stop()}),{priority:"lowest"})}_registerCoupledAttributesPostFixer(){const e=this.editor.model,t=e.document.selection;e.document.registerPostFixer((t=>{const i=e.document.differ.getChanges();let o=!1;const r=this._getCoupledAttributesMap();for(const e of i){if("attribute"!=e.type||null!==e.attributeNewValue)continue;const i=r.get(e.attributeKey);if(i)for(const{item:r}of e.range.getWalker({shallow:!0}))for(const e of i)r.hasAttribute(e)&&(t.removeAttribute(e,r),o=!0)}return o})),this.listenTo(t,"change:attribute",((i,{attributeKeys:o})=>{const r=new Set,l=this._getCoupledAttributesMap();for(const e of o){if(t.hasAttribute(e))continue;const i=l.get(e);if(i)for(const e of i)t.hasAttribute(e)&&r.add(e)}0!=r.size&&e.change((e=>{for(const t of r)e.removeSelectionAttribute(t)}))}))}_registerAssociatedHtmlAttributesPostFixer(){const e=this.editor.model;e.document.registerPostFixer((t=>{const i=e.document.differ.getChanges();let o=!1;for(const r of i)if("insert"===r.type&&"$text"!==r.name)for(const i of r.attributes.keys())i.startsWith("html")&&i.endsWith("Attributes")&&(e.schema.checkAttribute(r.name,i)||(t.removeAttribute(i,r.position.nodeAfter),o=!0));return o}))}_getCoupledAttributesMap(){if(this._coupledAttributes)return this._coupledAttributes;this._coupledAttributes=new Map;for(const e of this._allowedElements)if(e.coupledAttribute&&e.model){const t=this._coupledAttributes.get(e.coupledAttribute);t?t.push(e.model):this._coupledAttributes.set(e.coupledAttribute,[e.model])}return this._coupledAttributes}_fireRegisterEvent(e){e.view&&this._disallowedElements.has(e.view)||this.fire(e.view?`register:${e.view}`:"register",e)}_registerObjectElement(e){const t=this.editor,o=t.model.schema,r=t.conversion,{view:l,model:n}=e;o.register(n,e.modelSchema),
/* istanbul ignore next: paranoid check -- @preserve */
l&&(o.extend(e.model,{allowAttributes:[y(l),"htmlContent"]}),t.data.registerRawContentMatcher({name:l}),r.for("upcast").elementToElement({view:l,model:E(e),converterPriority:i.low+2}),r.for("upcast").add(O(e,this)),r.for("editingDowncast").elementToStructure({model:{name:n,attributes:[y(l)]},view:k(t,e)}),r.for("dataDowncast").elementToElement({model:n,view:(e,{writer:t})=>C(l,e,t)}),r.for("dataDowncast").add(I(e)))}_registerBlockElement(e){const t=this.editor,o=t.model.schema,r=t.conversion,{view:l,model:n}=e;if(!o.isRegistered(e.model)){if(o.register(e.model,e.modelSchema),!l)return;r.for("upcast").elementToElement({model:n,view:l,converterPriority:i.low+2}),r.for("downcast").elementToElement({model:n,view:l})}l&&(o.extend(e.model,{allowAttributes:y(l)}),r.for("upcast").add(O(e,this)),r.for("downcast").add(I(e)))}_registerInlineElement(e){const t=this.editor,i=t.model.schema,o=t.conversion,r=e.model;e.appliesToBlock||(i.extend("$text",{allowAttributes:r}),e.attributeProperties&&i.setAttributeProperties(r,e.attributeProperties),o.for("upcast").add(S(e,this)),o.for("downcast").attributeToElement({model:r,view:$(e)}),e.allowEmpty&&(i.setAttributeProperties(r,{copyFromObject:!1}),i.isRegistered("htmlEmptyElement")||i.register("htmlEmptyElement",{inheritAllFrom:"$inlineObject"}),t.data.htmlProcessor.domConverter.registerInlineObjectMatcher((t=>t.name==e.view&&t.isEmpty&&Array.from(t.getAttributeKeys()).length?{name:!0}:null)),o.for("editingDowncast").elementToElement({model:"htmlEmptyElement",view:F(e,!0)}),o.for("dataDowncast").elementToElement({model:"htmlEmptyElement",view:F(e)})))}}function D(e,t,i){const o=function(e,{consumable:t},i){const o=i.matchAll(e)||[],r=[];for(const i of o)x(t,e,i),delete i.match.name,t.consume(e,i.match),r.push(i);return r}(e,t,i),{attributes:l,styles:n,classes:s}=function(e){const t={attributes:new Set,classes:new Set,styles:new Set};for(const i of e)for(const e in t){(i.match[e]||[]).forEach((i=>t[e].add(i)))}return t}(o),m={};if(l.size)for(const e of l)r(e)||l.delete(e);return l.size&&(m.attributes=R(l,(t=>e.getAttribute(t)))),n.size&&(m.styles=R(n,(t=>e.getStyle(t)))),s.size&&(m.classes=Array.from(s)),Object.keys(m).length?m:null}function x(e,t,i){for(const o of["attributes","classes","styles"]){const r=i.match[o];if(r)for(const i of Array.from(r))e.test(t,{[o]:[i]})||b(r,i)}}function R(e,t){const i={};for(const o of e){void 0!==t(o)&&(i[o]=t(o))}return i}function j(e,t){const{name:i}=e,o=e[t];return g(o)?Object.entries(o).map((([e,o])=>({name:i,[t]:{[e]:o}}))):Array.isArray(o)?o.map((e=>({name:i,[t]:[e]}))):[e]}function N(e){const{name:t,attributes:i,classes:o,styles:r}=e,l=[];return i&&l.push(...j({name:t,attributes:i},"attributes")),o&&l.push(...j({name:t,classes:o},"classes")),r&&l.push(...j({name:t,styles:r},"styles")),l}
/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class V extends e{static get requires(){return[B]}static get pluginName(){return"CodeBlockElementSupport"}init(){if(!this.editor.plugins.has("CodeBlockEditing"))return;const e=this.editor.plugins.get(B);e.on("register:pre",((t,i)=>{if("codeBlock"!==i.model)return;const o=this.editor,r=o.model.schema,l=o.conversion;r.extend("codeBlock",{allowAttributes:["htmlPreAttributes","htmlContentAttributes"]}),l.for("upcast").add(function(e){return t=>{t.on("element:code",((t,i,o)=>{const r=i.viewItem,l=r.parent;function n(t,r){const l=e.processViewAttributes(t,o);l&&o.writer.setAttribute(r,l,i.modelRange)}l&&l.is("element","pre")&&(n(l,"htmlPreAttributes"),n(r,"htmlContentAttributes"))}),{priority:"low"})}}(e)),l.for("downcast").add((e=>{e.on("attribute:htmlPreAttributes:codeBlock",((e,t,i)=>{if(!i.consumable.consume(t.item,e.name))return;const{attributeOldValue:o,attributeNewValue:r}=t,l=i.mapper.toViewElement(t.item).parent;p(i.writer,o,r,l)})),e.on("attribute:htmlContentAttributes:codeBlock",((e,t,i)=>{if(!i.consumable.consume(t.item,e.name))return;const{attributeOldValue:o,attributeNewValue:r}=t,l=i.mapper.toViewElement(t.item);p(i.writer,o,r,l)}))})),t.stop()}))}}
/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */
class H extends e{static get requires(){return[B]}static get pluginName(){return"DualContentModelElementSupport"}init(){this.editor.plugins.get(B).on("register",((e,t)=>{const o=t,r=this.editor,l=r.model.schema,n=r.conversion;if(!o.paragraphLikeModel)return;if(l.isRegistered(o.model)||l.isRegistered(o.paragraphLikeModel))return;const s={model:o.paragraphLikeModel,view:o.view};l.register(o.model,o.modelSchema),l.register(s.model,{inheritAllFrom:"$block"}),n.for("upcast").elementToElement({view:o.view,model:(e,{writer:t})=>this._hasBlockContent(e)?t.createElement(o.model):t.createElement(s.model),converterPriority:i.low+.5}),n.for("downcast").elementToElement({view:o.view,model:o.model}),this._addAttributeConversion(o),n.for("downcast").elementToElement({view:s.view,model:s.model}),this._addAttributeConversion(s),e.stop()}))}_hasBlockContent(e){const t=this.editor.editing.view,i=t.domConverter.blockElements;for(const o of t.createRangeIn(e).getItems())if(o.is("element")&&i.includes(o.name))return!0;return!1}_addAttributeConversion(e){const t=this.editor,i=t.conversion,o=t.plugins.get(B);t.model.schema.extend(e.model,{allowAttributes:y(e.view)}),i.for("upcast").add(O(e,o)),i.for("downcast").add(I(e))}}
/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class M extends e{static get requires(){return[P,w]}static get pluginName(){return"HeadingElementSupport"}init(){const e=this.editor;if(!e.plugins.has("HeadingEditing"))return;const t=e.config.get("heading.options");this.registerHeadingElements(e,t)}registerHeadingElements(e,t){const i=e.plugins.get(P),o=[];for(const e of t)"model"in e&&"view"in e&&(i.registerBlockElement({view:e.view,model:e.model}),o.push(e.model));i.extendBlockElement({model:"htmlHgroup",modelSchema:{allowChildren:o}})}}
/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function L(e,t,i){const o=e.createRangeOn(t);for(const{item:e}of o.getWalker())if(e.is("element",i))return e}
/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class q extends e{static get requires(){return[B]}static get pluginName(){return"ImageElementSupport"}init(){const e=this.editor;if(!e.plugins.has("ImageInlineEditing")&&!e.plugins.has("ImageBlockEditing"))return;const t=e.model.schema,i=e.conversion,o=e.plugins.get(B);o.on("register:figure",(()=>{i.for("upcast").add(function(e){return t=>{t.on("element:figure",((t,i,o)=>{const r=i.viewItem;if(!i.modelRange||!r.hasClass("image"))return;const l=e.processViewAttributes(r,o);l&&o.writer.setAttribute("htmlFigureAttributes",l,i.modelRange)}),{priority:"low"})}}(o))})),o.on("register:img",((r,l)=>{"imageBlock"!==l.model&&"imageInline"!==l.model||(t.isRegistered("imageBlock")&&t.extend("imageBlock",{allowAttributes:["htmlImgAttributes","htmlFigureAttributes","htmlLinkAttributes"]}),t.isRegistered("imageInline")&&t.extend("imageInline",{allowAttributes:["htmlA","htmlImgAttributes"]}),i.for("upcast").add(function(e){return t=>{t.on("element:img",((t,i,o)=>{if(!i.modelRange)return;const r=i.viewItem,l=e.processViewAttributes(r,o);l&&o.writer.setAttribute("htmlImgAttributes",l,i.modelRange)}),{priority:"low"})}}(o)),i.for("downcast").add((e=>{function t(t){e.on(`attribute:${t}:imageInline`,((e,t,i)=>{if(!i.consumable.consume(t.item,e.name))return;const{attributeOldValue:o,attributeNewValue:r}=t,l=i.mapper.toViewElement(t.item);p(i.writer,o,r,l)}),{priority:"low"})}function i(t,i){e.on(`attribute:${i}:imageBlock`,((e,i,o)=>{if(!o.consumable.test(i.item,e.name))return;const{attributeOldValue:r,attributeNewValue:l}=i,n=o.mapper.toViewElement(i.item),s=L(o.writer,n,t);s&&(p(o.writer,r,l,s),o.consumable.consume(i.item,e.name))}),{priority:"low"}),"a"===t&&e.on("attribute:linkHref:imageBlock",((e,t,i)=>{if(!i.consumable.consume(t.item,"attribute:htmlLinkAttributes:imageBlock"))return;const o=i.mapper.toViewElement(t.item),r=L(i.writer,o,"a");A(i.writer,t.item.getAttribute("htmlLinkAttributes"),r)}),{priority:"low"})}t("htmlImgAttributes"),i("img","htmlImgAttributes"),i("figure","htmlFigureAttributes"),i("a","htmlLinkAttributes")})),e.plugins.has("LinkImage")&&i.for("upcast").add(function(e,t){const i=t.plugins.get("ImageUtils");return t=>{t.on("element:a",((t,o,r)=>{const l=o.viewItem;if(!i.findViewImgElement(l))return;const n=o.modelCursor.parent;if(!n.is("element","imageBlock"))return;const s=e.processViewAttributes(l,r);s&&r.writer.setAttribute("htmlLinkAttributes",s,n)}),{priority:"low"})}}(o,e)),r.stop())}))}}
/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */
class z extends e{static get requires(){return[B]}static get pluginName(){return"MediaEmbedElementSupport"}init(){const e=this.editor;if(!e.plugins.has("MediaEmbed")||e.config.get("mediaEmbed.previewsInData"))return;const t=e.model.schema,i=e.conversion,o=this.editor.plugins.get(B),r=this.editor.plugins.get(P),l=e.config.get("mediaEmbed.elementName");r.registerBlockElement({model:"media",view:l}),o.on("register:figure",(()=>{i.for("upcast").add(function(e){return t=>{t.on("element:figure",((t,i,o)=>{const r=i.viewItem;if(!i.modelRange||!r.hasClass("media"))return;const l=e.processViewAttributes(r,o);l&&o.writer.setAttribute("htmlFigureAttributes",l,i.modelRange)}),{priority:"low"})}}(o))})),o.on(`register:${l}`,((e,r)=>{"media"===r.model&&(t.extend("media",{allowAttributes:[y(l),"htmlFigureAttributes"]}),i.for("upcast").add(function(e,t){const i=(i,o,r)=>{function l(t,i){const l=e.processViewAttributes(t,r);l&&r.writer.setAttribute(i,l,o.modelRange)}l(o.viewItem,y(t))};return e=>{e.on(`element:${t}`,i,{priority:"low"})}}(o,l)),i.for("dataDowncast").add(function(e){return t=>{function i(e,i){t.on(`attribute:${i}:media`,((t,i,o)=>{if(!o.consumable.consume(i.item,t.name))return;const{attributeOldValue:r,attributeNewValue:l}=i,n=o.mapper.toViewElement(i.item),s=L(o.writer,n,e);p(o.writer,r,l,s)}))}i(e,y(e)),i("figure","htmlFigureAttributes")}}
/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */(l)),e.stop())}))}}class W extends e{static get requires(){return[B]}static get pluginName(){return"ScriptElementSupport"}init(){const e=this.editor.plugins.get(B);e.on("register:script",((t,i)=>{const o=this.editor,r=o.model.schema,l=o.conversion;r.register("htmlScript",i.modelSchema),r.extend("htmlScript",{allowAttributes:["htmlScriptAttributes","htmlContent"],isContent:!0}),o.data.registerRawContentMatcher({name:"script"}),l.for("upcast").elementToElement({view:"script",model:E(i)}),l.for("upcast").add(O(i,e)),l.for("downcast").elementToElement({model:"htmlScript",view:(e,{writer:t})=>C("script",e,t)}),l.for("downcast").add(I(i)),t.stop()}))}}
/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class G extends e{static get requires(){return[B]}static get pluginName(){return"TableElementSupport"}init(){const e=this.editor;if(!e.plugins.has("TableEditing"))return;const t=e.model.schema,i=e.conversion,o=e.plugins.get(B),r=e.plugins.get("TableUtils");o.on("register:figure",(()=>{i.for("upcast").add(function(e){return t=>{t.on("element:figure",((t,i,o)=>{const r=i.viewItem;if(!i.modelRange||!r.hasClass("table"))return;const l=e.processViewAttributes(r,o);l&&o.writer.setAttribute("htmlFigureAttributes",l,i.modelRange)}),{priority:"low"})}}(o))})),o.on("register:table",((l,n)=>{"table"===n.model&&(t.extend("table",{allowAttributes:["htmlTableAttributes","htmlFigureAttributes","htmlTheadAttributes","htmlTbodyAttributes"]}),i.for("upcast").add(function(e){return t=>{t.on("element:table",((t,i,o)=>{if(!i.modelRange)return;const r=i.viewItem;l(r,"htmlTableAttributes");for(const e of r.getChildren())e.is("element","thead")&&l(e,"htmlTheadAttributes"),e.is("element","tbody")&&l(e,"htmlTbodyAttributes");function l(t,r){const l=e.processViewAttributes(t,o);l&&o.writer.setAttribute(r,l,i.modelRange)}}),{priority:"low"})}}(o)),i.for("downcast").add((e=>{function t(t,i){e.on(`attribute:${i}:table`,((e,i,o)=>{if(!o.consumable.test(i.item,e.name))return;const r=o.mapper.toViewElement(i.item),l=L(o.writer,r,t);l&&(o.consumable.consume(i.item,e.name),p(o.writer,i.attributeOldValue,i.attributeNewValue,l))}))}t("table","htmlTableAttributes"),t("figure","htmlFigureAttributes"),t("thead","htmlTheadAttributes"),t("tbody","htmlTbodyAttributes")})),e.model.document.registerPostFixer(function(e,t){return i=>{const o=e.document.differ.getChanges();let r=!1;for(const e of o){if("attribute"!=e.type||"headingRows"!=e.attributeKey)continue;const o=e.range.start.nodeAfter,l=o.getAttribute("htmlTheadAttributes"),n=o.getAttribute("htmlTbodyAttributes");l&&!e.attributeNewValue?(i.removeAttribute("htmlTheadAttributes",o),r=!0):n&&e.attributeNewValue==t.getRows(o)&&(i.removeAttribute("htmlTbodyAttributes",o),r=!0)}return r}}(e.model,r)),l.stop())}))}}
/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */
class U extends e{static get requires(){return[B]}static get pluginName(){return"StyleElementSupport"}init(){const e=this.editor.plugins.get(B);e.on("register:style",((t,i)=>{const o=this.editor,r=o.model.schema,l=o.conversion;r.register("htmlStyle",i.modelSchema),r.extend("htmlStyle",{allowAttributes:["htmlStyleAttributes","htmlContent"],isContent:!0}),o.data.registerRawContentMatcher({name:"style"}),l.for("upcast").elementToElement({view:"style",model:E(i)}),l.for("upcast").add(O(i,e)),l.for("downcast").elementToElement({model:"htmlStyle",view:(e,{writer:t})=>C("style",e,t)}),l.for("downcast").add(I(i)),t.stop()}))}}
/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class K extends e{static get requires(){return[B]}static get pluginName(){return"DocumentListElementSupport"}init(){const e=this.editor;if(!e.plugins.has("DocumentListEditing"))return;const t=e.model.schema,i=e.conversion,o=e.plugins.get(B),r=e.plugins.get("DocumentListEditing"),l=["ul","ol","li"];r.registerDowncastStrategy({scope:"item",attributeName:"htmlLiAttributes",setAttributeOnDowncast:A}),r.registerDowncastStrategy({scope:"list",attributeName:"htmlUlAttributes",setAttributeOnDowncast:A}),r.registerDowncastStrategy({scope:"list",attributeName:"htmlOlAttributes",setAttributeOnDowncast:A}),o.on("register",((e,r)=>{if(!l.includes(r.view))return;if(e.stop(),t.checkAttribute("$block","htmlLiAttributes"))return;const n=l.map((e=>y(e)));t.extend("$listItem",{allowAttributes:n}),i.for("upcast").add((e=>{e.on("element:ul",X("htmlUlAttributes",o),{priority:"low"}),e.on("element:ol",X("htmlOlAttributes",o),{priority:"low"}),e.on("element:li",X("htmlLiAttributes",o),{priority:"low"})}))})),r.on("postFixer",((e,{listNodes:t,writer:i})=>{for(const{node:o,previousNodeInList:r}of t)if(r){if(r.getAttribute("listType")==o.getAttribute("listType")){const t=Q(r.getAttribute("listType")),l=r.getAttribute(t);!f(o.getAttribute(t),l)&&i.model.schema.checkAttribute(o,t)&&(i.setAttribute(t,l,o),e.return=!0)}if(r.getAttribute("listItemId")==o.getAttribute("listItemId")){const t=r.getAttribute("htmlLiAttributes");!f(o.getAttribute("htmlLiAttributes"),t)&&i.model.schema.checkAttribute(o,"htmlLiAttributes")&&(i.setAttribute("htmlLiAttributes",t,o),e.return=!0)}}})),r.on("postFixer",((e,{listNodes:t,writer:i})=>{for(const{node:o}of t){const t=o.getAttribute("listType");"numbered"!==t&&o.getAttribute("htmlOlAttributes")&&(i.removeAttribute("htmlOlAttributes",o),e.return=!0),"numbered"===t&&o.getAttribute("htmlUlAttributes")&&(i.removeAttribute("htmlUlAttributes",o),e.return=!0)}}))}afterInit(){const e=this.editor;if(!e.commands.get("indentList"))return;const t=e.commands.get("indentList");this.listenTo(t,"afterExecute",((t,i)=>{e.model.change((t=>{for(const o of i){const i=Q(o.getAttribute("listType"));e.model.schema.checkAttribute(o,i)&&t.setAttribute(i,{},o)}}))}))}}function X(e,t){return(i,o,r)=>{const l=o.viewItem;o.modelRange||Object.assign(o,r.convertChildren(o.viewItem,o.modelCursor));const n=t.processViewAttributes(l,r);for(const t of o.modelRange.getItems({shallow:!0}))t.hasAttribute("listItemId")&&(t.hasAttribute(e)||r.writer.model.schema.checkAttribute(t,e)&&r.writer.setAttribute(e,n||{},t))}}function Q(e){return"numbered"===e?"htmlOlAttributes":"htmlUlAttributes"}
/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Y extends e{static get requires(){return[B,P]}static get pluginName(){return"CustomElementSupport"}init(){const e=this.editor.plugins.get(B),t=this.editor.plugins.get(P);e.on("register:$customElement",((i,o)=>{i.stop();const r=this.editor,l=r.model.schema,n=r.conversion,m=r.editing.view.domConverter.unsafeElements,a=r.data.htmlProcessor.domConverter.preElements;l.register(o.model,o.modelSchema),l.extend(o.model,{allowAttributes:["htmlElementName","htmlCustomElementAttributes","htmlContent"],isContent:!0}),r.data.htmlProcessor.domConverter.registerRawContentMatcher({name:"template"}),n.for("upcast").elementToElement({view:/.*/,model:(i,l)=>{if("$comment"==i.name)return null;if(!function(e){try{document.createElement(e)}catch(e){return!1}return!0}
/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */(i.name))return null;if(t.getDefinitionsForView(i.name).size)return null;m.includes(i.name)||m.push(i.name),a.includes(i.name)||a.push(i.name);const n=l.writer.createElement(o.model,{htmlElementName:i.name}),c=e.processViewAttributes(i,l);let d;if(c&&l.writer.setAttribute("htmlCustomElementAttributes",c,n),i.is("element","template")&&i.getCustomProperty("$rawContent"))d=i.getCustomProperty("$rawContent");else{const e=new s(i.document).createDocumentFragment(i),t=r.data.htmlProcessor.domConverter.viewToDom(e),o=t.firstChild;for(;o.firstChild;)t.appendChild(o.firstChild);o.remove(),d=r.data.htmlProcessor.htmlWriter.getHtml(t)}l.writer.setAttribute("htmlContent",d,n);for(const{item:e}of r.editing.view.createRangeIn(i))l.consumable.consume(e,{name:!0});return n},converterPriority:"low"}),n.for("editingDowncast").elementToElement({model:{name:o.model,attributes:["htmlElementName","htmlCustomElementAttributes","htmlContent"]},view:(e,{writer:t})=>{const i=e.getAttribute("htmlElementName"),o=t.createRawElement(i);return e.hasAttribute("htmlCustomElementAttributes")&&A(t,e.getAttribute("htmlCustomElementAttributes"),o),o}}),n.for("dataDowncast").elementToElement({model:{name:o.model,attributes:["htmlElementName","htmlCustomElementAttributes","htmlContent"]},view:(e,{writer:t})=>{const i=e.getAttribute("htmlElementName"),o=e.getAttribute("htmlContent"),r=t.createRawElement(i,null,((e,t)=>{t.setContentOf(e,o)}));return e.hasAttribute("htmlCustomElementAttributes")&&A(t,e.getAttribute("htmlCustomElementAttributes"),r),r}})}))}}class J extends e{static get pluginName(){return"GeneralHtmlSupport"}static get requires(){return[B,V,H,M,q,z,W,G,U,K,Y]}init(){const e=this.editor,t=e.plugins.get(B);t.loadAllowedEmptyElementsConfig(e.config.get("htmlSupport.allowEmpty")||[]),t.loadAllowedConfig(e.config.get("htmlSupport.allow")||[]),t.loadDisallowedConfig(e.config.get("htmlSupport.disallow")||[])}getGhsAttributeNameForElement(e){const t=this.editor.plugins.get("DataSchema"),i=Array.from(t.getDefinitionsForView(e,!1)),o=i.find((e=>e.isInline&&!i[0].isObject));return o?o.model:y(e)}addModelHtmlClass(e,i,o){const r=this.editor.model,l=this.getGhsAttributeNameForElement(e);r.change((e=>{for(const n of Z(r,o,l))v(e,n,l,"classes",(e=>{for(const o of t(i))e.add(o)}))}))}removeModelHtmlClass(e,i,o){const r=this.editor.model,l=this.getGhsAttributeNameForElement(e);r.change((e=>{for(const n of Z(r,o,l))v(e,n,l,"classes",(e=>{for(const o of t(i))e.delete(o)}))}))}setModelHtmlAttributes(e,t,i){const o=this.editor.model,r=this.getGhsAttributeNameForElement(e);o.change((e=>{for(const l of Z(o,i,r))v(e,l,r,"attributes",(e=>{for(const[i,o]of Object.entries(t))e.set(i,o)}))}))}removeModelHtmlAttributes(e,i,o){const r=this.editor.model,l=this.getGhsAttributeNameForElement(e);r.change((e=>{for(const n of Z(r,o,l))v(e,n,l,"attributes",(e=>{for(const o of t(i))e.delete(o)}))}))}setModelHtmlStyles(e,t,i){const o=this.editor.model,r=this.getGhsAttributeNameForElement(e);o.change((e=>{for(const l of Z(o,i,r))v(e,l,r,"styles",(e=>{for(const[i,o]of Object.entries(t))e.set(i,o)}))}))}removeModelHtmlStyles(e,i,o){const r=this.editor.model,l=this.getGhsAttributeNameForElement(e);r.change((e=>{for(const n of Z(r,o,l))v(e,n,l,"styles",(e=>{for(const o of t(i))e.delete(o)}))}))}}function*Z(e,t,i){if(t)if(!(Symbol.iterator in t)&&t.is("documentSelection")&&t.isCollapsed)e.schema.checkAttributeInSelection(t,i)&&(yield t);else for(const o of function(e,t,i){return!(Symbol.iterator in t)&&(t.is("node")||t.is("$text")||t.is("$textProxy"))?e.schema.checkAttribute(t,i)?[e.createRangeOn(t)]:[]:e.schema.getValidRanges(e.createSelection(t).getRanges(),i)}
/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */(e,t,i))yield*o.getItems({shallow:!0})}class ee extends e{static get pluginName(){return"HtmlComment"}init(){const e=this.editor,t=new Map;e.data.processor.skipComments=!1,e.model.schema.addAttributeCheck(((e,t)=>{if(e.endsWith("$root")&&t.startsWith("$comment"))return!0})),e.conversion.for("upcast").elementToMarker({view:"$comment",model:e=>{const i=`$comment:${l()}`,o=e.getCustomProperty("$rawContent");return t.set(i,o),i}}),e.conversion.for("dataDowncast").markerToElement({model:"$comment",view:(e,{writer:t})=>{let i;for(const t of this.editor.model.document.getRootNames())if(i=this.editor.model.document.getRoot(t),i.hasAttribute(e.markerName))break;const o=e.markerName,r=i.getAttribute(o),l=t.createUIElement("$comment");return t.setCustomProperty("$rawContent",r,l),l}}),e.model.document.registerPostFixer((i=>{let o=!1;const r=e.model.document.differ.getChangedMarkers().filter((e=>e.name.startsWith("$comment:")));for(const e of r){const{oldRange:r,newRange:l}=e.data;if(!r||!l||r.root!=l.root){if(r){const t=r.root;t.hasAttribute(e.name)&&(i.removeAttribute(e.name,t),o=!0)}if(l){const r=l.root;"$graveyard"==r.rootName?(i.removeMarker(e.name),o=!0):r.hasAttribute(e.name)||(i.setAttribute(e.name,t.get(e.name)||"",r),o=!0)}}}return o})),e.data.on("set",(()=>{for(const t of e.model.markers.getMarkersGroup("$comment"))this.removeHtmlComment(t.name)}),{priority:"high"}),e.model.on("deleteContent",((t,[i])=>{for(const t of i.getRanges()){const i=e.model.schema.getLimitElement(t),o=e.model.createPositionAt(i,0),r=e.model.createPositionAt(i,"end");let l;l=o.isTouching(t.start)&&r.isTouching(t.end)?this.getHtmlCommentsInRange(e.model.createRange(o,r)):this.getHtmlCommentsInRange(t,{skipBoundaries:!0});for(const e of l)this.removeHtmlComment(e)}}),{priority:"high"})}createHtmlComment(e,t){const i=l(),o=this.editor.model,r=o.document.getRoot(e.root.rootName),n=`$comment:${i}`;return o.change((i=>{const o=i.createRange(e);return i.addMarker(n,{usingOperation:!0,affectsData:!0,range:o}),i.setAttribute(n,t,r),n}))}removeHtmlComment(e){const t=this.editor,i=t.model.markers.get(e);return!!i&&(t.model.change((e=>{e.removeMarker(i)})),!0)}getHtmlCommentData(e){const t=this.editor.model.markers.get(e);if(!t)return null;let i="";for(const t of this.editor.model.document.getRoots())if(t.hasAttribute(e)){i=t.getAttribute(e);break}return{content:i,position:t.getStart()}}getHtmlCommentsInRange(e,{skipBoundaries:t=!1}={}){const i=!t;return Array.from(this.editor.model.markers.getMarkersGroup("$comment")).filter((t=>function(e,t){const o=e.getRange().start;return(o.isAfter(t.start)||i&&o.isEqual(t.start))&&(o.isBefore(t.end)||i&&o.isEqual(t.end))}(t,e))).map((e=>e.name))}}
/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class te extends m{toView(e){if(!e.match(/<(?:html|body|head|meta)(?:\s[^>]*)?>/i))return super.toView(e);let t="",i="";e=(e=e.replace(/<!DOCTYPE[^>]*>/i,(e=>(t=e,"")))).replace(/<\?xml\s[^?]*\?>/i,(e=>(i=e,"")));const o=this._toDom(e),r=this.domConverter.domToView(o,{skipComments:this.skipComments}),l=new s(r.document);return l.setCustomProperty("$fullPageDocument",o.ownerDocument.documentElement.outerHTML,r),t&&l.setCustomProperty("$fullPageDocType",t,r),i&&l.setCustomProperty("$fullPageXmlDeclaration",i,r),r}toData(e){let t=super.toData(e);const i=e.getCustomProperty("$fullPageDocument"),o=e.getCustomProperty("$fullPageDocType"),r=e.getCustomProperty("$fullPageXmlDeclaration");return i&&(t=i.replace(/<\/body\s*>/,t+"$&"),o&&(t=o+"\n"+t),r&&(t=r+"\n"+t)),t}}
/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ie extends e{static get pluginName(){return"FullPage"}init(){const e=this.editor,t=["$fullPageDocument","$fullPageDocType","$fullPageXmlDeclaration"];e.data.processor=new te(e.data.viewDocument),e.model.schema.extend("$root",{allowAttributes:t}),e.data.on("toModel",((i,[o])=>{const r=e.model.document.getRoot();e.model.change((e=>{for(const i of t){const t=o.getCustomProperty(i);t&&e.setAttribute(i,t,r)}}))}),{priority:"low"}),e.data.on("toView",((e,[i])=>{if(!i.is("rootElement"))return;const o=i,r=e.return;if(!o.hasAttribute("$fullPageDocument"))return;const l=new s(r.document);for(const e of t){const t=o.getAttribute(e);t&&l.setCustomProperty(e,t,r)}}),{priority:"low"}),e.data.on("set",(()=>{const i=e.model.document.getRoot();e.model.change((e=>{for(const o of t)i.hasAttribute(o)&&e.removeAttribute(o,i)}))}),{priority:"high"}),e.data.on("get",((e,t)=>{t[0]||(t[0]={}),t[0].trim=!1}),{priority:"high"})}}export{B as DataFilter,P as DataSchema,ie as FullPage,J as GeneralHtmlSupport,ee as HtmlComment,te as HtmlPageDataProcessor};